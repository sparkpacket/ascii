<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image/GIF/Video to ASCII Converter</title>
<style>
    body {
        font-family: monospace;
        background-color: #111;
        color: #eee;
        text-align: center;
        padding: 20px;
    }
    #asciiOutput {
        white-space: pre;
        display: inline-block;
        text-align: left;
        line-height: 7px; /* adjust for vertical scaling */
        font-size: 8px;
    }
    input, label {
        margin: 5px;
    }
</style>
</head>
<body>
<h1>Image / GIF / Video to ASCII</h1>
<input type="file" id="mediaInput" accept="image/*,video/*"><br>
<label for="size">Width (characters): </label>
<input type="number" id="size" value="100" min="10" max="500"><br>
<label for="color">Color: </label>
<input type="checkbox" id="color"><br>
<button id="convertBtn">Convert</button>

<pre id="asciiOutput"></pre>

<script>
const mediaInput = document.getElementById('mediaInput');
const convertBtn = document.getElementById('convertBtn');
const asciiOutput = document.getElementById('asciiOutput');
const sizeInput = document.getElementById('size');
const colorCheckbox = document.getElementById('color');

const asciiChars = " .:-=+*#%@"; // dark to light
let playing = false;

function frameToAscii(ctx, width, height){
    const imageData = ctx.getImageData(0, 0, width, height).data;
    let asciiStr = '';
    for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
            const i = (y * width + x) * 4;
            const r = imageData[i];
            const g = imageData[i + 1];
            const b = imageData[i + 2];
            const brightness = (0.299*r + 0.587*g + 0.114*b);
            const char = asciiChars[Math.floor((brightness/255) * (asciiChars.length-1))];
            
            if(colorCheckbox.checked){
                asciiStr += `<span style="color: rgb(${r},${g},${b})">${char}</span>`;
            } else {
                asciiStr += char;
            }
        }
        asciiStr += '\n';
    }
    asciiOutput.innerHTML = asciiStr;
}

convertBtn.addEventListener('click', () => {
    if (!mediaInput.files[0]) return alert("Please upload an image, GIF, or video!");
    const file = mediaInput.files[0];
    const url = URL.createObjectURL(file);

    let media;
    if (file.type.startsWith("video") || file.type.endsWith("gif")) {
        media = document.createElement('video');
        media.src = url;
        media.loop = true;
        media.muted = true;
        media.play();
    } else {
        media = new Image();
        media.src = url;
    }

    media.onload = media.onloadeddata = () => {
        const width = parseInt(sizeInput.value);
        const scale = media.height / media.width;
        const height = Math.floor(width * scale);

        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');

        if (media.tagName === "IMG") {
            // Static image
            ctx.drawImage(media, 0, 0, width, height);
            frameToAscii(ctx, width, height);
        } else {
            // GIFs and Videos: animate
            playing = true;
            function renderFrame(){
                if (!playing) return;
                ctx.drawImage(media, 0, 0, width, height);
                frameToAscii(ctx, width, height);
                requestAnimationFrame(renderFrame);
            }
            renderFrame();
        }
    };
});
</script>
</body>
</html>
