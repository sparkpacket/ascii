<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image / GIF / Video to ASCII</title>
<style>
    body {
        font-family: monospace;
        background-color: #111;
        color: #eee;
        text-align: center;
        padding: 20px;
    }
    #asciiOutput {
        white-space: pre;
        display: inline-block;
        text-align: left;
        line-height: 7px; /* vertical scaling */
        font-size: 8px;
    }
    input, label, button {
        margin: 5px;
    }
</style>
</head>
<body>
<h1>Image / GIF / Video to ASCII</h1>
<input type="file" id="mediaInput" accept="image/*,video/*"><br>
<label for="size">Width (characters): </label>
<input type="number" id="size" value="100" min="10" max="500"><br>
<label for="color">Color: </label>
<input type="checkbox" id="color"><br>
<button id="convertBtn">Convert</button>
<button id="pauseBtn" disabled>Pause</button>
<button id="resumeBtn" disabled>Resume</button>
<label for="speed">Speed: </label>
<input type="number" id="speed" value="100" min="10" max="1000"> ms/frame

<pre id="asciiOutput"></pre>

<script>
const asciiChars = " .:-=+*#%@"; // dark to light
const asciiOutput = document.getElementById("asciiOutput");
const mediaInput = document.getElementById("mediaInput");
const sizeInput = document.getElementById("size");
const colorCheckbox = document.getElementById("color");
const convertBtn = document.getElementById("convertBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resumeBtn = document.getElementById("resumeBtn");
const speedInput = document.getElementById("speed");

let frames = [];
let frameIndex = 0;
let intervalId = null;
let paused = false;

function frameToAscii(ctx, width, height) {
    const imageData = ctx.getImageData(0, 0, width, height).data;
    let asciiStr = '';
    for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
            const i = (y * width + x) * 4;
            const r = imageData[i];
            const g = imageData[i+1];
            const b = imageData[i+2];
            const brightness = (0.299*r + 0.587*g + 0.114*b);
            const char = asciiChars[Math.floor((brightness/255) * (asciiChars.length-1))];
            if (colorCheckbox.checked) {
                asciiStr += `<span style="color:rgb(${r},${g},${b})">${char}</span>`;
            } else {
                asciiStr += char;
            }
        }
        asciiStr += "\n";
    }
    return asciiStr;
}

function playFrames() {
    clearInterval(intervalId);
    intervalId = setInterval(() => {
        if (!paused && frames.length > 0) {
            asciiOutput.innerHTML = frames[frameIndex];
            frameIndex = (frameIndex + 1) % frames.length; // loop
        }
    }, parseInt(speedInput.value));
}

convertBtn.addEventListener("click", () => {
    if (!mediaInput.files[0]) return alert("Upload an image, GIF, or video!");

    frames = [];
    frameIndex = 0;
    clearInterval(intervalId);

    const file = mediaInput.files[0];
    const url = URL.createObjectURL(file);

    if (file.type.startsWith("image/") && !file.type.endsWith("gif")) {
        // Regular static image
        const img = new Image();
        img.src = url;
        img.onload = () => {
            const width = parseInt(sizeInput.value);
            const scale = img.height / img.width;
            const height = Math.floor(width * scale);
            const canvas = document.createElement("canvas");
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, width, height);
            asciiOutput.innerHTML = frameToAscii(ctx, width, height);
        };
    } else {
        // GIFs & videos â†’ capture frames
        const video = document.createElement("video");
        video.src = url;
        video.muted = true;
        video.loop = false;
        video.play();

        video.onloadeddata = () => {
            const width = parseInt(sizeInput.value);
            const scale = video.videoHeight / video.videoWidth;
            const height = Math.floor(width * scale);

            const canvas = document.createElement("canvas");
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d");

            function capture() {
                if (video.ended) {
                    // All frames captured
                    video.pause();
                    playFrames();
                    pauseBtn.disabled = false;
                    resumeBtn.disabled = false;
                    return;
                }
                ctx.drawImage(video, 0, 0, width, height);
                frames.push(frameToAscii(ctx, width, height));
                requestAnimationFrame(capture);
            }
            capture();
        };
    }
});

pauseBtn.addEventListener("click", () => { paused = true; });
resumeBtn.addEventListener("click", () => { paused = false; });
speedInput.addEventListener("change", playFrames);
</script>
</body>
</html>
